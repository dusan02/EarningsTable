#!/bin/bash
# PostupnÃ¡ kontrola logov firiem

cd /srv/EarningsTable && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && echo "KROK 1: EXISTUJE TABUÄ½KA PRE LOGÃ?" && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && sqlite3 modules/database/prisma/prod.db ".tables" | grep -E "finnhub_data|polygon_data|final_report|cron_execution_log" && echo "" && echo "âœ… TabuÄ¾ky existujÃº:" && sqlite3 modules/database/prisma/prod.db "SELECT name FROM sqlite_master WHERE type='table' AND name IN ('finnhub_data', 'polygon_data', 'final_report', 'cron_execution_log');" && echo "" && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && echo "KROK 2: ODKIAÄ½ SA Å¤AHAJÃš LOGÃ?" && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && echo "ğŸ“Š Finnhub API:" && echo "   - Endpoint: https://finnhub.io/api/v1/calendar/earnings" && echo "   - ZÃ­skava: EPS, Revenue, Quarter, Year" && echo "   - UkladÃ¡ do: finnhub_data" && echo "" && echo "ğŸ“Š Polygon API:" && echo "   - Endpoint: https://api.polygon.io/v3/reference/tickers/{symbol}" && echo "   - ZÃ­skava: Market Cap, Price, Company Name" && echo "   - UkladÃ¡ do: polygon_data" && echo "" && echo "ğŸ“Š Final Report:" && echo "   - Kombinuje dÃ¡ta z finnhub_data + polygon_data" && echo "   - UkladÃ¡ do: final_report" && echo "" && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && echo "KROK 3: KAM SA UKLADAJÃš LOGÃ?" && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && echo "ğŸ“‹ finnhub_data:" && sqlite3 modules/database/prisma/prod.db "SELECT COUNT(*) as count FROM finnhub_data;" && echo "" && echo "ğŸ“‹ polygon_data:" && sqlite3 modules/database/prisma/prod.db "SELECT COUNT(*) as count FROM polygon_data;" && echo "" && echo "ğŸ“‹ final_report:" && sqlite3 modules/database/prisma/prod.db "SELECT COUNT(*) as count FROM final_report;" && echo "" && echo "ğŸ“‹ cron_execution_log:" && sqlite3 modules/database/prisma/prod.db "SELECT COUNT(*) as count FROM cron_execution_log;" && echo "" && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && echo "KROK 4: DOÅ¤AHUJÃš SA LOGÃ OK DO APLIKÃCIE?" && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && echo "ğŸ“Š PoslednÃ© spustenia cron jobov:" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT jobType, status, datetime(startedAt, 'localtime') as startedAt, datetime(completedAt, 'localtime') as completedAt, duration, recordsProcessed FROM cron_execution_log ORDER BY startedAt DESC LIMIT 10;" && echo "" && echo "ğŸ“Š AktuÃ¡lny stav cron jobov:" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT jobType, datetime(lastRunAt, 'localtime') as lastRunAt, status, recordsProcessed FROM cron_status ORDER BY lastRunAt DESC;" && echo "" && echo "ğŸ“Š PoslednÃ© dÃ¡ta z finnhub_data (top 5):" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT symbol, datetime(reportDate, 'localtime') as reportDate, epsActual, revenueActual FROM finnhub_data ORDER BY reportDate DESC, symbol LIMIT 5;" && echo "" && echo "ğŸ“Š PoslednÃ© dÃ¡ta z polygon_data (top 5):" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT symbol, name, marketCap, price FROM polygon_data ORDER BY updatedAt DESC LIMIT 5;" && echo "" && echo "ğŸ“Š PoslednÃ© dÃ¡ta z final_report (top 5):" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT symbol, name, marketCap, price, datetime(updatedAt, 'localtime') as updatedAt FROM final_report ORDER BY updatedAt DESC LIMIT 5;" && echo "" && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && echo "KROK 5: KONTROLA SYSTEMD CRON SERVICE" && echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" && systemctl is-active earnings-cron && echo "" && echo "ğŸ“‹ PoslednÃ© logy z earnings-cron (poslednÃ½ch 20 riadkov):" && journalctl -u earnings-cron -n 20 --no-pager | tail -10

