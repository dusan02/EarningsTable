#!/bin/bash
# Check if logs are being written after systemd migration

cd /srv/EarningsTable && echo "=== 1. Systemd status ===" && systemctl status earnings-cron --no-pager -l | head -15 && echo "" && echo "=== 2. Recent systemd logs (last 30 lines) ===" && journalctl -u earnings-cron -n 30 --no-pager && echo "" && echo "=== 3. Database logs count ===" && sqlite3 modules/database/prisma/prod.db "SELECT COUNT(*) as total_logs FROM cron_execution_log;" && echo "" && echo "=== 4. Latest 10 logs from database ===" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT id, jobType, status, datetime(startedAt, 'localtime') as startedAt, datetime(completedAt, 'localtime') as completedAt, duration, recordsProcessed FROM cron_execution_log ORDER BY startedAt DESC LIMIT 10;" && echo "" && echo "=== 5. Current CronStatus ===" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT jobType, datetime(lastRunAt, 'localtime') as lastRunAt, status, recordsProcessed FROM cron_status ORDER BY lastRunAt DESC;" && echo "" && echo "=== 6. Check for SIGINT in logs ===" && journalctl -u earnings-cron --since "5 minutes ago" | grep -iE "SIGINT|SIGTERM|Ignoring" | tail -10 || echo "âœ… No SIGINT/SIGTERM events in last 5 minutes"

