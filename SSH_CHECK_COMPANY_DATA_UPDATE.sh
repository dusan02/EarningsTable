#!/bin/bash
# Kontrola aktualizácie dát firiem

cd /srv/EarningsTable && echo "═══════════════════════════════════════════════════════════" && echo "KONTROLA: AKTUALIZUJÚ SA DÁTA FIRIEM?" && echo "═══════════════════════════════════════════════════════════" && echo "" && echo "1. Posledné spustenia pipeline (hľadanie 'Pipeline' alebo 'runPipeline'):" && journalctl -u earnings-cron -n 500 --no-pager | grep -E "Pipeline|runPipeline|Starting.*pipeline" | tail -15 || echo "Žiadne pipeline logy" && echo "" && echo "2. Posledné spustenia Finnhub jobu:" && journalctl -u earnings-cron -n 500 --no-pager | grep -E "Starting Finnhub|Finnhub.*completed|Found.*earnings reports" | tail -10 || echo "Žiadne Finnhub logy" && echo "" && echo "3. Posledné spustenia Polygon jobu:" && journalctl -u earnings-cron -n 500 --no-pager | grep -E "Starting Polygon|Polygon.*completed|Found.*symbols" | tail -10 || echo "Žiadne Polygon logy" && echo "" && echo "4. Aktuálne dátumy v final_report (kontrola updatedAt):" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT symbol, name, datetime(updatedAt, 'localtime') as updatedAt, datetime(createdAt, 'localtime') as createdAt FROM final_report ORDER BY updatedAt DESC LIMIT 10;" && echo "" && echo "5. Porovnanie s aktuálnym dátumom:" && echo "   Aktuálny dátum: $(date '+%Y-%m-%d %H:%M:%S')" && echo "   Posledný update: $(sqlite3 modules/database/prisma/prod.db "SELECT datetime(MAX(updatedAt), 'localtime') FROM final_report;")" && echo "" && echo "6. Kontrola finnhub_data (kontrola reportDate):" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT symbol, datetime(reportDate, 'localtime') as reportDate, datetime(updatedAt, 'localtime') as updatedAt FROM finnhub_data ORDER BY reportDate DESC LIMIT 5;" && echo "" && echo "7. Kontrola polygon_data (kontrola updatedAt):" && sqlite3 -header -column modules/database/prisma/prod.db "SELECT symbol, name, datetime(updatedAt, 'localtime') as updatedAt FROM polygon_data ORDER BY updatedAt DESC LIMIT 5;"

